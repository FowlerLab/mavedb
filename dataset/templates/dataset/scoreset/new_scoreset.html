{% extends "main/base.html" %}

{% block body %}

<div class="row">
	<div class="col-md-2 border border-top-0 border-bottom-0 border-left-0 border-secondary">
		<h3>
			Create new scoreset
		</h3>
		{% if experiment_urn %}
			<a href="{% url 'dataset:experiment_detail' experiment_urn %}"><h4 class="mt-4">Skip for now</h4></a>
		{% endif %}
		<p class="mt-4">
			Please fill out the form to the right. All fields will remain editable until published.
		</p>
		<p>* indicates a required field</p>
	</div>

	<div class="col-md-8 mx-3">
		<form action="{% url 'dataset:scoreset_new' %}" method="POST" enctype="multipart/form-data">
			{% csrf_token %}
			
			{% if scoreset_form.non_field_errors or target_form.non_field_errors or reference_map_form.non_field_errors or interval_formset.non_form_errors %}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <h4> Oh no! </h4>
          <p> There were some errors with your submission </p>
          <hr>
          <p>{{ scoreset_form.non_field_errors }}</p>
          <p>{{ target_form.non_field_errors }}</p>
          <p>{{ reference_map_form.non_field_errors }}</p>
          <p>{{ interval_formset.non_form_errors }}</p>
        </div>
			{% endif %}

			<div id="keywords-to-add" hidden>{{ repop_keywords }}</div>
			<div id="sra-identifiers-to-add" hidden>{{ repop_sra_identifiers }}</div>
			<div id="doi-identifiers-to-add" hidden>{{ repop_doi_identifiers }}</div>
			<div id="pubmed-identifiers-to-add" hidden>{{ repop_pubmed_identifiers }}</div>

			<div class="model-form">
				{% for field in scoreset_form %}
					<div class="form-group">
						<label for="{{ field.id_for_label }}">
							{{ field.label }}{% if field.field.required %}*{% endif %}
							{% if field.label == "Abstract" %}
								<!-- Button trigger modal -->
								<button type="button" class="btn btn-outline-dark btn-sm ml-2" data-toggle="modal"
												data-target="#abstract-markdown-modal" id="preview-abstract">
								Preview
								</button>
							{% endif %}

							{% if field.label == "Method description" %}
								<!-- Button trigger modal -->
								<button type="button" class="btn btn-outline-dark btn-sm ml-2" data-toggle="modal"
												data-target="#method-markdown-modal" id="preview-method">
								Preview
								</button>
							{% endif %}
						</label>

						{% if field.errors %}
							<div class="alert alert-danger alert-dismissible fade show" role="alert">
								<button type="button" class="close" data-dismiss="alert" aria-label="Close">
									<span aria-hidden="true">&times;</span>
								</button>
								{{ field.errors }}
							</div>
						{% endif %}
						<br>
						{{ field }}
					</div>
				{% endfor %}
			</div>
			<hr>

      <hr>
      <div class="model-form">
        <h3>Target Gene</h3>
        {% for field in target_form %}
          <div class="form-group">
            <label for="{{ field.id_for_label }}">
              {{ field.label }}{% if field.field.required %}*{% endif %}
            </label>
            {% if field.errors %}
              <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
                {{ field.errors }}
              </div>
            {% endif %}
            <br>
            {{ field }}
          </div>
        {% endfor %}

        <hr>
        <h4>Reference</h4>
          {% for field in reference_map_form %}
            <div class="form-group">
              <label for="{{ field.id_for_label }}" style="padding-right:10px">
                {{ field.label }}{% if field.field.required %}*{% endif %}
              </label>
              {% if field.errors %}
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                  {{ field.errors }}
                </div>
              {% endif %}
              <br>
              {{ field }}
            </div>
          {% endfor %}
        <hr>

        <h5>Annotations</h5>
        <table class="table">
          {% if interval_form.non_field_errors %}
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
              <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
              {{ interval_form.non_field_errors }}
            </div>
          {% endif %}

          <thead>
          <tr>
            {% for field in interval_form.visible_fields %}
                <th>{{ field.label|capfirst }}{% if field.field.required %}*{% endif %}</th>
            {% endfor %}
          </tr>
          </thead>

          <tr class="formset_row">
            {% for field in interval_form.visible_fields %}
              <td>
                {# Include the hidden fields in the form #}
                {% if forloop.first %}
                    {% for hidden in interval_form.hidden_fields %}
                        {{ hidden }}
                    {% endfor %}
                {% endif %}
                {% if field.errors %}
                  <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                    {{ field.errors.as_ul }}
                  </div>
                {% endif %}
                {{ field }}
              </td>
            {% endfor %}
          </tr>
        </table>
      </div>
      <hr>

			<div style="width:100%;margin-top:5px;">
				<input class="btn btn-outline-dark" type="submit" value="Save" name="save"
								style="width:150px;margin-bottom:35px;" data-toggle="tooltip" 
								data-placement="top|right|bottom|left"
								title="Save your changes without publishing.">
				<input type="submit" value="Publish" class="btn btn-outline-danger" data-toggle="tooltip" 
							data-placement="top|right|bottom|left" name="publish"
							title="Publish your entry. This action is final and will freeze your certain aspects of your entry."
							style="width:150px;margin-bottom:35px;" id="publish">
			</div>
		</form>
	</div>
</div>
{% endblock body %}