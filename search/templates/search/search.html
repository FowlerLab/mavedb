{% extends "main/base.html" %}

{% block body %}

<div class="container-fluid">

  <div class="container">
    <form class="mb-2" action="{% url 'search:search' %}" method="get">
      <div class="input-group">
        <input class="form-control" name="search">
        <button class="btn btn-outline-dark white-button ml-1">
          <i class="fa fa-search"></i>
        </button>
        <button class="btn btn-outline-dark white-button ml-1" data-toggle="collapse" data-target="#search-options" type="button">
          <i class="fa fa-gear"></i>
        </button>
      </div>
    </form>
  </div>

<div id="search-options" class="row collapse fade mt-2" aria-hidden="true">
	<div class="container card" >
		<div class="card-body">
			<div class="card-header bg-white mb-2">
				<h4 class="form-title"> Advanced search </h4>
			</div>

			<form action="{% url 'search:search' %}" method="GET">
        <h5 class="pb-2 form-title">Metadata:</h5>
        {% include 'core/bs_neutral_form.html' with form=meta_search_form %}
        <hr>
        <h5 class="pb-2 form-title">External identifiers:</h5>
        {% include 'core/bs_inline_form.html' with form=meta_id_search_form %}
        <hr>
        <h5 class="pb-2 form-title">Target gene identifiers:</h5>
        {% include 'core/bs_inline_form.html' with form=target_id_search_form %}
        <hr>
        <h5 class="pb-2 form-title">Reference genome:</h5>
        {% include 'core/bs_inline_form.html' with form=genome_search_form %}
        <hr>
        <h5 class="pb-2 form-title">Contributors:</h5>
        {% include 'core/bs_inline_form.html' with form=user_search_form %}

        <div class="card-footer bg-white">
					<button class="btn btn-outline-dark float-right white-button" style="width: 150px;" type="submit">Search</button>
				</div>
			</form>
		
		</div> <!-- End card body -->
	</div> <!-- End card -->
</div> <!-- end row -->
<hr>

<div class="styled-table mt-4">
	<table id="search-table" class="table table-hover">
		<thead>
			<tr>
				<th class="clickable-row">Urn</th>
				<th class="clickable-row">Short description</th>
        <th class="clickable-row">Target name</th>
        <th class="clickable-row">Target organisms</th>
        <th class="clickable-row">Contributors</th>
      </tr>
		</thead>
		<tbody>
			{% if not instances|length > 0 %}
				<tr>
					<td colspan=6> 0 search results returned. </td>
				</tr>
			{% else %}
				{% for instance in instances  %}
					{% if not instance.private %}
						<tr>
							<td>
                {% if instance.class_name == 'experiment' %}
                  <a href="{% url 'dataset:experiment_detail' instance.urn %}">
                    {{ instance.urn }}
                  </a>
                {% else %}
                  <a href="{% url 'dataset:scoreset_detail' instance.urn %}">
                    {{ instance.urn }}
                  </a>
                {% endif %}
							</td>
              <td>{{ instance.short_description|default:"-" }}</td>
              <td>
                {% if instance.class_name == 'experiment' %}
                  {{ instance.get_target_names|join:", "|default:"-" }}
                {% else %}
                    {{ instance.get_target.name|default:"-" }}
                {% endif %}
              </td>
              <td>
                {{ instance.get_display_target_organisms|safeseq|join:", "|default:"-"|safe }}
              </td>
              <td>
                {% for c in instance.contributors %}
                  {{ c.profile.get_display_name_hyperlink|safe }}
                {% endfor %}
              </td>
            </tr>
          {% else %}
            {% if request.user in instance.contributors %}
              <tr>
                <td>
                  {% if instance.class_name == 'experiment' %}
                    <a href="{% url 'dataset:experiment_detail' instance.urn %}">
                      {{ instance.urn }} [Private]
                    </a>
                  {% else %}
                    <a href="{% url 'dataset:scoreset_detail' instance.urn %}">
                      {{ instance.urn }} [Private]
                    </a>
                  {% endif %}
                </td>
                <td>{{ instance.short_description|default:"-" }}</td>
                <td>
                  {% if instance.class_name == 'experiment' %}
                    {{ instance.get_target_names|join:", "|default:"-" }}
                  {% else %}
                      {{ instance.get_target.name|default:"-" }}
                  {% endif %}
                </td>
                <td>
                  {{ instance.get_display_target_organisms|safeseq|join:", "|default:"-"|safe }}
                </td>
                <td>
                  {% for c in instance.contributors %}
                    {{ c.profile.get_display_name_hyperlink|safe }}
                  {% endfor %}
                </td>
              </tr>
            {% endif %}
          {% endif %}
				{% endfor %}
      {% endif %}
		</tbody>
	</table>
</div>
{% endblock %}