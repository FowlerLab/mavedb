{% extends "main/base.html" %}

{% block body %}

<div class="container-fluid mb-4" style="width:100%;">
	<div class="container" style="float: none; margin: 0 auto;">
		<form class="form-inline my-2 my-lg-0" action="{% url 'search:search' %}" method="GET">
			<input class="form-control mr-sm-1" type="text" aria-label="Search"
							placeholder="Search..." name="search_all" style="width:80%;">
			<button class="btn btn-outline-dark my-2 my-sm-0" type="submit">
				Search
			</button>
			<button data-toggle="collapse" data-target="#search-options" 
							class="btn btn-outline-primary ml-1" type="button">
					Advanced
			</button>
		</form>
	</div>
</div>


<div id="search-options" class="row collapse fade" aria-hidden="true">
	<div class="container card" >
		<div class="card-body">
			<div class="card-header bg-white mb-2">
				<h4> Advanced search </h4>
			</div>

			{% if form.non_field_errors %}
				<div class="alert alert-danger alert-dismissible fade show" role="alert">
					<button type="button" class="close" data-dismiss="alert" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4> Oh no! </h4>
						<p> There were some errors with your submission </p>
						<hr>
						<p>{{ form.non_field_errors }}</p>
				</div>
			{% endif %}
			
			<form action="{% url 'search:search' %}" method="GET">
				{% for field in form %}
					<div class="form-group">
						<label for="{{ field.id_for_label }}">
							{{ field.label }}{% if field.field.required %}*{% endif %}
						</label>
						{% if field.errors %}
							<div class="alert alert-danger alert-dismissible fade show" role="alert">
								<button type="button" class="close" data-dismiss="alert" aria-label="Close">
									<span aria-hidden="true">&times;</span>
								</button>
								{{ field.errors }}
							</div>
						{% endif %}
						<br>
						{{ field }}
					</div>
				{% endfor %}
				<div class="card-footer bg-white">
					<input class="btn btn-outline-dark float-right" style="width: 150px;" 
								 type="submit" name="submit" value="Search">
				</div>
			</form>
		
		</div> <!-- End card body -->
	</div> <!-- End card -->
</div> <!-- end row -->

<div class="search-results table-container row mt-5">
	<table id="search-table" class="styled-table table table-hover paginated">
		<thead>
			<tr>
				<th onclick="sortTable('search-table', 0)" class="clickable-row">Urn</th>
				<th onclick="sortTable('search-table', 1)" class="clickable-row">Short description</th>
        <th onclick="sortTable('search-table', 2)" class="clickable-row">Target name</th>
        <th onclick="sortTable('search-table', 3)" class="clickable-row">Target organisms</th>
        <th onclick="sortTable('search-table', 5)" class="clickable-row">Contributors</th>
      </tr>
		</thead>
		<tbody>
			{% if not experiments.count %}
				<tr>
					<td colspan=6> 0 search results returned. </td>
				</tr>
			{% else %}
				{% for exp in experiments  %}
					{% if not exp.private %}
						<tr>
							<td>
								<a href="{% url 'dataset:experiment_detail' exp.urn %}">
									{{ exp.urn }}
								</a>
							</td>
              <td>{{ exp.short_description|default:"-" }}</td>
              <td>{{ exp.get_target_names|join:", "|default:"-" }}</td>
              <td>
                {% if exp.get_target_organisms|length > 0 %}
                  {{ exp.get_target_organisms|safeseq|join:", "|default:"-" }}
                {% else %}
                  -
                {% endif %}
              </td>
              <td>
                {% for c in exp.contributors %}
                  {{ c.profile.get_display_name_hyperlink }}
                {% endfor %}
              </td>
            </tr>
          {% else %}
            <tr>
              <td>
                <a href="{% url 'dataset:experiment_detail' exp.urn %}">
                  {{ exp.urn }} [Private]
                </a>
              </td>
              <td>{{ exp.short_description|default:"-" }}</td>
              <td>{{ exp.get_target_names|join:", "|default:"-" }}</td>
              <td>
                {% if exp.get_target_organisms|length > 0 %}
                  {{ exp.get_target_organisms|safeseq|join:", "|default:"-" }}
                {% else %}
                  -
                {% endif %}
              </td>
              <td>
                {% for c in exp.contributors %}
                  {{ c.profile.get_display_name_hyperlink }}
                {% endfor %}
              </td>
            </tr>
          {% endif %}
				{% endfor %}
      {% endif %}
		</tbody>
	</table>
</div>

{#<!-- Pagination -->#}
{#{% if experiments.has_other_pages %}#}
{#<div class="row">#}
{#	<div class="col-md-2 mt-2">#}
{#		<form action="?per-page=" method="GET">#}
{#			<div class="form-inline">#}
{#				<label class="mr-2" for="per-page-select"> Entries per page </label>#}
{#				<select name="per-page" id="per-page-select" onchange="paginationSubmit('search')">#}
{#					{% for i in per_page_selections %}#}
{#						{% if i == per_page %}#}
{#							<option value={{i}} selected="">{{i}}</option>#}
{#						{% else %}#}
{#							<option value={{i}}>{{i}}</option>#}
{#						{% endif %}#}
{#					{% endfor %}#}
{#				</select>#}
{#			</div>#}
{#		</form>#}
{#	</div>#}
{##}
{#	<div class="col-md-10">#}
{#		<ul class="pagination justify-content-end">#}
{#			{% if experiments.has_previous %}#}
{#				<li class="page-item">#}
{#					<a class="page-link previous" href=""#}
{#						 onclick="return paginationSubmit('search', this);">#}
{#						&laquo;#}
{#						<div id="search-previous" hidden>{{ experiments.previous_page_number }}</div>#}
{#					</a>#}
{#				</li>#}
{#			{% else %}#}
{#				<li class="page-item disabled">#}
{#					<a class="page-link" href="">#}
{#						<span aria-hidden="true">&laquo;</span>#}
{#					</a>#}
{#				</li>#}
{#			{% endif %}#}
{#			#}
{#			{% for i in experiments.paginator.page_range %}#}
{#				<li class="page-item">#}
{#					<a class="page-link {% if experiments.number == i %}search-active{% endif %}" href="" #}
{#						 onclick="return paginationSubmit('search', this);">{{ i }}</a>#}
{#				</li>#}
{#			{% endfor %}#}
{#			#}
{#			{% if experiments.has_next %}#}
{#				<li class="page-item">#}
{#					<a class="page-link previous" href=""#}
{#						 onclick="return paginationSubmit('search', this);">#}
{#						&raquo;#}
{#						<div id="search-next" hidden>{{ experiments.next_page_number }}</div>#}
{#					</a>#}
{#				</li>#}
{#			{% else %}#}
{#				<li class="page-item disabled">#}
{#					<a class="page-link" href="">#}
{#						<span aria-hidden="true">&raquo;</span>#}
{#					</a>#}
{#				</li>#}
{#			{% endif %}#}
{#		</ul>#}
{#	</div>#}
{#</div>#}
{#{% endif %} <!-- End pagination -->#}

{% endblock %}