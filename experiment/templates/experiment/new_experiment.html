{% extends "main/base.html" %}

{% block body %}
<div class="row">
	<div class="col-md-2 border border-top-0 border-bottom-0 border-left-0 border-secondary">
		<h3>Create new experiment</h3>
	</div>
	
	<!-- Composite form rendering -->
	<div class="col-md-8 mx-3">
		<form action="{% url 'experiment:experiment_new' %}" method="POST">
			{% csrf_token %}
			
			{% if experiment_form.non_field_errors %}
			<div class="alert alert-danger alert-dismissible fade show">
				<h4> Oh no! </h4>
				<p> There were some errors with your submission </p>
				<hr>
				<p>{{ experiment_form.non_field_errors }}</p>
			</div>
			{% endif %}

			<div id="keywords-to-add" hidden>{{ repop_keywords }}</div>
			<div id="accession-to-add" hidden>{{ repop_external_accessions }}</div>
			<div id="organisms-to-add" hidden>{{ repop_target_organism }}</div>
			
			<!-- Model form rendering -->
			<div class="model-form">
				{% for field in experiment_form %}
					<div class="form-group">
						<label for="{{ field.id_for_label }}">
							{{ field.label }}{% if field.field.required %} * {% endif %}
						</label>
						{% if field.errors %}
							<div class="alert alert-danger alert-dismissible fade show" role="alert">
								<button type="button" class="close" data-dismiss="alert" aria-label="Close">
									<span aria-hidden="true">&times;</span>
								</button>	
								{{ field.errors }}
						</div>
						{% endif %}
						<br>
						{{ field }}
					</div>
				{% endfor %}
			<br><hr> <!-- End model form rendering -->
			
			<!-- Formset rendering -->
			<div class="reference_mapping-forms">
				<h4> Reference maps 
					<input class="btn btn-sm btn-outline-dark" type="button" value="+" id="add_reference_mapping">
					<input class="btn btn-sm btn-outline-dark" type="button" value="-" id="remove_reference_mapping">
				</h4>
				<div id="reference_mapping-form-set">
					{{ reference_mapping_formset.management_form }}
					<div id='reference_mapping-empty-set' style="display:none;">
						<p>I'll add reference maps later.<p><hr>
					</div>
					{% for form in reference_mapping_formset %}
						<div id="reference_mapping-formset-{{ forloop.counter }}">
							{% for field in form %}
								<div class="form-group">
									<label for="{{ field.id_for_label }}">
										{{ field.label }}{% if field.field.required %}*{% endif %}
									</label>
									{% if field.errors %}
										<div class="alert alert-danger alert-dismissible fade show" role="alert">
											<button type="button" class="close" data-dismiss="alert" aria-label="Close">
												<span aria-hidden="true">&times;</span>
											</button>	
											{{ field.errors }}
										</div>
									{% endif %}
									<br>
									{{ field }}
								</div>
							{% endfor %}
						<hr>
						</div>
					{% endfor %}
				</div>
			</div> <!-- End formset rendering -->
			
			<!-- Empty formset for add/minus buttons -->
			<div id="reference_mapping-empty-form" style="display:none">
				{% for field in reference_mapping_formset.empty_form %}
					<div class="form-group">
						<label for="{{ field.id_for_label }}">
							{{ field.label }}{% if field.field.required %}*{% endif %}
						</label>
						{% if field.errors %}
							<div class="alert alert-danger alert-dismissible fade show" role="alert">
								<button type="button" class="close" data-dismiss="alert" aria-label="Close">
									<span aria-hidden="true">&times;</span>
								</button>		
								{{ field.errors }}
							</div>
						{% endif %}
						<br>
						{{ field }}
					</div>
				{% endfor %}
			</div>
			
			<input class="btn btn-outline-dark" style="width: 200px;" 
						type="submit" name="submit" value="Submit">
		</form>
	</div> <!-- End composite form rendering -->
</div>
{% endblock body %}